function updateCardData(response, db) {
    var data = JSON.parse(response.text)
    data.data.forEach(entry => {
        var card = cards[entry.code]
        if (card) {
            if (card.title) {
                entry.title = card.title
            }
            if (card.text) {
                entry.text = card.text
            }
            if (card.keywords) {
                entry.keywords = card.keywords
            }
        }
    })
    response.text = JSON.stringify(data)
    response.headers["content-language"] = locale
}

function updateData(response, db) {
    var data = JSON.parse(response.text)
    data.data.forEach(entry => {
        if (db[entry.code] && db[entry.code].name) {
            entry.name = db[entry.code].name
        }
    })
    response.text = JSON.stringify(data)
    response.headers["content-language"] = locale
}

xhook.after(function(request, response) {
    if (request.url == "/api/2.0/public/cards") {
        updateCardData(response, cards)
    } else if (request.url == "/api/2.0/public/types") {
        updateData(response, types)
    } else if (request.url == "/api/2.0/public/cycles") {
        updateData(response, cycles)
    } else if (request.url == "/api/2.0/public/packs") {
        updateData(response, packs)
    } else if (request.url == "/api/2.0/public/factions") {
        updateData(response, factions)
    }
})
